---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { AppProviders } from "../../react-pages/AppProviders";
import ArticleDetailPage from "../../react-pages/ArticleDetailPage";
import NotFound from "../../react-pages/NotFound";

import articles from "../../data/articles.json";
import brands from "../../data/brands.json";

// ⚠️ Importamos el RadarChart como componente ASTRO
import ArticleRadarChart from "../../components/article/RadarChart.astro";


export async function getStaticPaths() {
  const articles = (await import("../../data/articles.json")).default;

  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { slug } = Astro.params;

// Buscamos el artículo
const article = articles.find((item) => item.slug === slug);

// Marca asociada
const brand = article
  ? brands.find((item) => item.id === article.brandId)
  : undefined;

// Título de la página
const pageTitle = article
  ? `${article.title} | PetFood Expert`
  : "Artículo no encontrado";
---
<BaseLayout title={pageTitle}>
  <!-- Contenido React (NO tocar el radar aquí) -->
  <AppProviders client:load client:idle>
    {article ? (
      <ArticleDetailPage article={article} brand={brand} />
    ) : (
      <NotFound path={Astro.url.pathname} />
    )}
  </AppProviders>

  <!-- RadarChart como Astro Island (FUERA DE REACT) -->
  {article && (
    <div class="container mt-6">
      <ArticleRadarChart scores={article.scores} />
    </div>
  )}
</BaseLayout>
